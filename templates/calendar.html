{% extends "base.html" %}

{% block title %}–ö–∞–ª–µ–Ω–¥–∞—Ä –∑–º–∞–≥–∞–Ω—å {{ current_year }} - –§–µ–¥–µ—Ä–∞—Ü—ñ—è –î–∑—é–¥–æ –£–∫—Ä–∞—ó–Ω–∏{% endblock %}

{% block content %}
<main class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8">
    
    <!-- Page Title -->
    <div class="mb-6 md:mb-8">
        <h1 class="text-2xl sm:text-3xl md:text-4xl font-black text-[#111718] tracking-tight leading-tight mb-2">
            –ö–∞–ª–µ–Ω–¥–∞—Ä –∑–º–∞–≥–∞–Ω—å {{ current_year }}
        </h1>
        <p class="text-sm sm:text-base text-gray-500 max-w-2xl">
            –û—Ñ—ñ—Ü—ñ–π–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥ –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏—Ö —á–µ–º–ø—ñ–æ–Ω–∞—Ç—ñ–≤, –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∏—Ö —Ç—É—Ä–Ω—ñ—Ä—ñ–≤ —Ç–∞ –Ω–∞–≤—á–∞–ª—å–Ω–æ-—Ç—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏—Ö –∑–±–æ—Ä—ñ–≤.
        </p>
    </div>

    <!-- Two Column Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-8">
        
        <!-- Left Column: Events (8 cols) -->
        <div class="lg:col-span-8 flex flex-col gap-4 md:gap-6">
            
            <!-- Mobile Navigation (visible only on mobile) -->
            <div class="lg:hidden bg-white rounded-xl md:rounded-2xl p-4 shadow-soft border border-white">
                <div class="space-y-3">
                    <!-- Current period -->
                    <div class="text-center p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-100">
                        <div class="text-[10px] text-gray-500 mb-0.5 uppercase tracking-wide font-semibold">–ü–µ—Ä–µ–≥–ª—è–¥–∞—î—Ç–µ</div>
                        <div class="text-base font-black text-gray-900">{{ month_name }} {{ current_year }}</div>
                    </div>
                    
                    <!-- Events count -->
                    <div class="flex items-center justify-between px-4 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg shadow-sm">
                        <span class="text-xs font-semibold text-white">
                            {% if total_events == 1 %}–ü–æ–¥—ñ—è{% elif total_events < 5 %}–ü–æ–¥—ñ—ó{% else %}–ü–æ–¥—ñ–π{% endif %}
                        </span>
                        <span class="text-2xl font-black text-white">{{ total_events }}</span>
                    </div>
                    
                    <!-- Navigation -->
                    <div class="grid grid-cols-2 gap-2">
                        <a href="#" 
                        data-nav="prev" 
                        data-month="{{ current_month - 1 if current_month > 1 else 12 }}" 
                        data-year="{{ current_year if current_month > 1 else current_year - 1 }}"
                        class="flex items-center justify-center gap-2 px-3 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-all">
                            <span class="material-symbols-outlined text-[16px]">arrow_back</span>
                            <span class="text-sm">–ù–∞–∑–∞–¥</span>
                        </a>
                        <a href="#" 
                        data-nav="next" 
                        data-month="{{ current_month + 1 if current_month < 12 else 1 }}" 
                        data-year="{{ current_year if current_month < 12 else current_year + 1 }}"
                        class="flex items-center justify-center gap-2 px-3 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-all">
                            <span class="text-sm">–í–ø–µ—Ä–µ–¥</span>
                            <span class="material-symbols-outlined text-[16px]">arrow_forward</span>
                        </a>
                    </div>

                    
                    <a href="/calendar" class="block w-full px-3 py-2 bg-white border-2 border-blue-600 text-blue-600 text-center font-semibold rounded-lg transition-all active:bg-blue-50 text-sm">
                        –ü–æ—Ç–æ—á–Ω–∏–π –º—ñ—Å—è—Ü—å
                    </a>
                </div>
            </div>
            
            <!-- Filters Bar -->
            <div id="filters-bar" class="flex flex-wrap items-center gap-2 md:gap-3 bg-white p-3 rounded-xl shadow-sm border border-gray-100">
                
                <!-- Type Filter -->
                <div class="relative group custom-filter-dropdown" data-name="type" data-value="{{ current_type }}">
                    <button class="flex items-center gap-1.5 px-2.5 md:px-3 py-1.5 bg-gray-50 border border-transparent hover:border-gray-200 active:border-gray-300 rounded-lg text-xs md:text-sm font-medium transition-all text-gray-700">
                        <span class="filter-label">
                            {% if current_type == 'international' %}–ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω—ñ
                            {% elif current_type == 'national' %}–ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ
                            {% else %}–¢–∏–ø{% endif %}
                        </span>
                        <span class="material-symbols-outlined text-gray-400 text-[16px] md:text-[18px]">expand_more</span>
                    </button>
                    <div class="filter-dropdown-menu">
                        <button class="filter-dropdown-item" data-value="all">–í—Å—ñ –ø–æ–¥—ñ—ó</button>
                        <button class="filter-dropdown-item" data-value="international">–ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω—ñ</button>
                        <button class="filter-dropdown-item" data-value="national">–ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ</button>
                    </div>
                </div>

                <!-- Status Filter -->
                <div class="relative group custom-filter-dropdown" data-name="status" data-value="{{ current_status }}">
                    <button class="flex items-center gap-1.5 px-2.5 md:px-3 py-1.5 bg-gray-50 border border-transparent hover:border-gray-200 active:border-gray-300 rounded-lg text-xs md:text-sm font-medium transition-all text-gray-700">
                        <span class="filter-label">
                            {% if current_status == 'ongoing' %}üî¥ –ó–∞—Ä–∞–∑
                            {% elif current_status == 'planned' %}üîµ –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ
                            {% elif current_status == 'completed' %}‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                            {% else %}–°—Ç–∞—Ç—É—Å{% endif %}
                        </span>
                        <span class="material-symbols-outlined text-gray-400 text-[16px] md:text-[18px]">expand_more</span>
                    </button>
                    <div class="filter-dropdown-menu">
                        <button class="filter-dropdown-item" data-value="all">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</button>
                        <button class="filter-dropdown-item" data-value="ongoing">üî¥ –ó–∞—Ä–∞–∑</button>
                        <button class="filter-dropdown-item" data-value="planned">üîµ –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ</button>
                        <button class="filter-dropdown-item" data-value="completed">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ</button>
                    </div>
                </div>

                <!-- Category Filter -->
                <div class="relative group custom-filter-dropdown" data-name="category" data-value="{{ current_category }}">
                    <button class="flex items-center gap-1.5 px-2.5 md:px-3 py-1.5 bg-gray-50 border border-transparent hover:border-gray-200 active:border-gray-300 rounded-lg text-xs md:text-sm font-medium transition-all text-gray-700">
                        <span class="filter-label">
                            {% if current_category == 'championship' %}–ß–µ–º–ø—ñ–æ–Ω–∞—Ç–∏
                            {% elif current_category == 'cup' %}–ö—É–±–∫–∏
                            {% elif current_category == 'tournament' %}–¢—É—Ä–Ω—ñ—Ä–∏
                            {% elif current_category == 'seminar' %}–°–µ–º—ñ–Ω–∞—Ä–∏
                            {% elif current_category == 'training' %}–ù–¢–ó
                            {% else %}–ö–∞—Ç–µ–≥–æ—Ä—ñ—è{% endif %}
                        </span>
                        <span class="material-symbols-outlined text-gray-400 text-[16px] md:text-[18px]">expand_more</span>
                    </button>
                    <div class="filter-dropdown-menu">
                        <button class="filter-dropdown-item" data-value="all">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</button>
                        <button class="filter-dropdown-item" data-value="championship">–ß–µ–º–ø—ñ–æ–Ω–∞—Ç–∏</button>
                        <button class="filter-dropdown-item" data-value="cup">–ö—É–±–∫–∏</button>
                        <button class="filter-dropdown-item" data-value="tournament">–¢—É—Ä–Ω—ñ—Ä–∏</button>
                        <button class="filter-dropdown-item" data-value="seminar">–°–µ–º—ñ–Ω–∞—Ä–∏</button>
                        <button class="filter-dropdown-item" data-value="training">–ù–¢–ó</button>
                    </div>
                </div>

                <!-- Clear Filters -->
                <div class="ml-auto">
                    <button onclick="clearAllFilters()" class="flex items-center justify-center w-8 h-8 md:w-auto md:px-2 md:py-1.5 rounded-lg text-gray-400 hover:text-blue-600 active:bg-gray-100 transition-colors" title="–°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏">
                        <span class="material-symbols-outlined text-[20px]">tune</span>
                    </button>
                </div>
            </div>

            <!-- Events List by Month -->
            <div id="events-container" class="space-y-3 md:space-y-4">
                {% if events %}
                    {% set ns = namespace(previous_month='') %}
                    {% for event in events %}
                        {% if event.date_start %}
                            {% set event_month_year = event.month_genitive + ' ' + event.date_start.year|string %}
                            
                            <!-- Month Header (only when month changes) -->
                            {% if event_month_year != ns.previous_month %}
                                <div class="sticky top-14 md:top-16 z-30 backdrop-blur py-2 border-b border-gray-200 -mx-4 px-4 md:mx-0 md:px-0">
                                    <span class="text-xs md:text-sm font-bold text-gray-500 uppercase tracking-wider">{{ event_month_year }}</span>
                                </div>
                                {% set ns.previous_month = event_month_year %}
                            {% endif %}

                            <!-- Event Card -->
                            <article class="card-gradient group relative flex flex-col rounded-lg md:rounded-xl shadow-soft border border-white hover:border-blue-500/20 active:border-blue-500/40 transition-all duration-300 overflow-hidden {% if event.status == 'completed' %}opacity-90{% endif %}">
                                
                                <!-- Mobile Layout -->
                                <div class="md:hidden">
                                    <!-- Top row: Date + Status -->
                                    <div class="flex items-start justify-between p-3 pb-2 border-b border-gray-100">
                                        <div class="flex items-center gap-2">
                                            <div class="flex flex-col items-center justify-center px-2.5 py-1.5 {% if event.status == 'completed' %}bg-gray-100{% else %}bg-blue-50{% endif %} rounded-lg">
                                                <span class="text-xl font-black {% if event.status == 'completed' %}text-gray-400{% else %}text-blue-600{% endif %} leading-none">{{ event.date_start.day }}</span>
                                                <span class="text-[9px] font-bold text-gray-400 uppercase tracking-wide">{{ event.month_genitive }}</span>
                                            </div>
                                            
                                            <!-- Type badge -->
                                            {% if event.event_type == 'international' %}
                                            <span class="text-[10px] font-bold px-2 py-1 bg-purple-50 text-purple-700 border border-purple-200 rounded-md">
                                                üåç –ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∏–π
                                            </span>
                                            {% else %}
                                            <span class="text-[10px] font-bold px-2 py-1 bg-blue-50 text-blue-700 border border-blue-200 rounded-md">
                                                üá∫üá¶ –ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π
                                            </span>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- Status badge -->
                                        {% if event.status == 'ongoing' %}
                                        <span class="inline-flex items-center gap-1 px-2 py-1 bg-red-500 text-white text-[10px] font-bold rounded-full shadow-sm">
                                            <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span>
                                            –ó–∞—Ä–∞–∑
                                        </span>
                                        {% elif event.status == 'completed' %}
                                        <span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-[10px] font-semibold rounded-full">
                                            <span class="material-symbols-outlined text-[12px]">check_circle</span>
                                            –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Content -->
                                    <div class="p-3">
                                        <!-- Category & Age -->
                                        <div class="flex flex-wrap items-center gap-1.5 mb-2">
                                            {% if event.category_label %}
                                            <span class="text-[10px] font-bold {% if event.category == 'championship' %}text-blue-600{% elif event.category == 'cup' %}text-amber-600{% elif event.category == 'training' or event.category == 'training_camp' %}text-emerald-600{% else %}text-gray-600{% endif %}">
                                                {{ event.category_label }}
                                            </span>
                                            {% endif %}
                                            
                                            {% if event.age_group_label %}
                                            <span class="text-[10px] text-gray-400">‚Ä¢</span>
                                            <span class="text-[10px] font-medium text-gray-500">{{ event.age_group_label }}</span>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- Title -->
                                        <h3 class="text-sm font-bold text-gray-900 leading-snug mb-2 line-clamp-2">
                                            {{ event.title }}
                                        </h3>
                                        
                                        <!-- Location -->
                                        {% if event.city %}
                                        <div class="flex items-center gap-1.5 text-[11px] text-gray-600 mb-2">
                                            <span class="material-symbols-outlined text-[14px] text-gray-400">location_on</span>
                                            <span>{{ event.city }}{% if event.region and event.event_type != 'international' %}, {{ event.region }}{% endif %}</span>
                                        </div>
                                        {% endif %}
                                        
                                        <!-- Data indicators -->
                                        <div class="flex flex-wrap items-center gap-1.5 mb-3">
                                            {% if event.regulation_url or event.regulation_path %}
                                            <span class="inline-flex items-center gap-0.5 px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded text-[9px] font-medium">
                                                <span class="material-symbols-outlined text-[11px]">description</span>
                                                <span>–ü–æ–ª–æ–∂–µ–Ω–Ω—è</span>
                                            </span>
                                            {% endif %}

                                            {% if event.protocols_parsed and event.protocols_parsed|length > 0 %}
                                            <span class="inline-flex items-center gap-0.5 px-1.5 py-0.5 bg-green-50 text-green-700 rounded text-[9px] font-medium">
                                                <span class="material-symbols-outlined text-[11px]">emoji_events</span>
                                                <span>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏</span>
                                            </span>
                                            {% endif %}

                                            {% if event.live_streams_parsed and event.live_streams_parsed|length > 0 %}
                                            <span class="inline-flex items-center gap-0.5 px-1.5 py-0.5 bg-red-50 text-red-700 rounded text-[9px] font-medium">
                                                <span class="material-symbols-outlined text-[11px]">live_tv</span>
                                                <span>–¢—Ä–∞–Ω—Å–ª—è—Ü—ñ—è</span>
                                            </span>
                                            {% endif %}

                                            {% if event.program_parsed and event.program_parsed|length > 0 %}
                                            <span class="inline-flex items-center gap-0.5 px-1.5 py-0.5 bg-purple-50 text-purple-700 rounded text-[9px] font-medium">
                                                <span class="material-symbols-outlined text-[11px]">calendar_today</span>
                                                <span>–ü—Ä–æ–≥—Ä–∞–º–∞</span>
                                            </span>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- Action button -->
                                        <a href="/calendar/{{ event.slug }}" class="block w-full px-3 py-2 {% if event.status == 'ongoing' %}bg-blue-600 text-white{% elif event.status == 'completed' %}bg-blue-50 text-blue-600 border border-blue-200{% else %}bg-blue-600 text-white{% endif %} text-center font-semibold rounded-lg text-sm transition-all active:scale-95">
                                            {% if event.status == 'completed' %}–†–µ–∑—É–ª—å—Ç–∞—Ç–∏
                                            {% elif event.status == 'ongoing' %}–î–µ—Ç–∞–ª—ñ
                                            {% else %}–î–µ—Ç–∞–ª—ñ{% endif %}
                                        </a>
                                    </div>
                                </div>

                                <!-- Desktop Layout (hidden on mobile) -->
                                <div class="hidden md:flex">
                                    <!-- Date Block (Left) -->
                                    <div class="w-20 flex flex-col items-center justify-center p-4 border-r border-gray-100 {% if event.status == 'completed' %}bg-gray-50{% else %}bg-white{% endif %} shrink-0 relative z-10">
                                        <span class="text-2xl font-black {% if event.status == 'completed' %}text-gray-400{% else %}text-blue-600{% endif %} tracking-tighter">{{ event.date_start.day }}</span>
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mt-1">{{ event.month_genitive }}</span>
                                    </div>

                                    <!-- Content -->
                                    <div class="flex-1 p-4 relative z-10 flex flex-col justify-center gap-1.5">
                                        <!-- Type & Age Group -->
                                        <div class="flex flex-wrap gap-2">
                                            {% if event.category_label %}
                                            <span class="text-xs font-bold {% if event.event_type == 'international' %}text-purple-600{% elif event.category == 'championship' %}text-blue-600{% elif event.category == 'cup' %}text-amber-600{% elif event.category == 'training' or event.category == 'training_camp' %}text-emerald-600{% else %}text-gray-600{% endif %}">
                                                {{ event.category_label }}
                                            </span>
                                            {% endif %}
                                            
                                            {% if event.age_group_label %}
                                            <span class="text-xs font-medium text-gray-400">‚Ä¢</span>
                                            <span class="text-xs font-medium text-gray-500">{{ event.age_group_label }}</span>
                                            {% endif %}
                                        </div>

                                        <!-- Title -->
                                        <div class="flex items-center gap-2">
                                            <h3 class="text-base sm:text-lg font-bold text-gray-900 leading-snug group-hover:text-blue-700 transition-colors">
                                                {{ event.title }}
                                            </h3>
                                            {% if event.featured %}
                                            <span class="material-symbols-outlined text-blue-600 text-[18px]" title="–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –ø–æ–¥—ñ—è">verified</span>
                                            {% endif %}
                                        </div>

                                        <!-- Meta Info -->
                                        <div class="flex flex-wrap items-center gap-x-5 gap-y-2 text-xs sm:text-sm text-gray-500 mt-1">
                                            <!-- Location -->
                                            {% if event.city %}
                                            <div class="flex items-center gap-1.5 text-gray-600">
                                                <span class="material-symbols-outlined text-[18px] text-gray-400">{% if event.event_type == 'international' %}public{% else %}location_on{% endif %}</span>
                                                <span>{{ event.city }}{% if event.region and event.event_type != 'international' %}, {{ event.region }}{% endif %}</span>
                                            </div>
                                            {% endif %}

                                            <!-- Organizer -->
                                            {% if event.organizer %}
                                            <div class="flex items-center gap-1.5">
                                                <span class="material-symbols-outlined text-[18px] text-gray-400">corporate_fare</span>
                                                <span>–û—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä: {{ event.organizer }}</span>
                                            </div>
                                            {% endif %}

                                            <!-- Status Badge (only for ongoing and completed) -->
                                            {% if event.status == 'ongoing' %}
                                            <div class="flex items-center gap-1.5">
                                                <span class="material-symbols-outlined text-[18px] text-red-500">radio_button_checked</span>
                                                <span class="text-red-600 font-medium">–ó–∞—Ä–∞–∑</span>
                                            </div>
                                            {% elif event.status == 'completed' %}
                                            <div class="flex items-center gap-1.5">
                                                <span class="material-symbols-outlined text-[18px] text-green-500">check_circle</span>
                                                <span class="text-green-600 font-medium">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                                            </div>
                                            {% endif %}
                                        </div>

                                        <!-- Available Data Indicators -->
                                        <div class="flex flex-wrap items-center gap-2 mt-2">
                                            {% if event.regulation_url or event.regulation_path %}
                                            <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-blue-50 text-blue-700 rounded-md text-[11px] font-medium" title="–ü–æ–ª–æ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–Ω–µ">
                                                <span class="material-symbols-outlined text-[14px]">description</span>
                                                <span>–ü–æ–ª–æ–∂–µ–Ω–Ω—è</span>
                                            </span>
                                            {% endif %}

                                            {% if event.protocols_parsed and event.protocols_parsed|length > 0 %}
                                            <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-green-50 text-green-700 rounded-md text-[11px] font-medium" title="–ü—Ä–æ—Ç–æ–∫–æ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ">
                                                <span class="material-symbols-outlined text-[14px]">emoji_events</span>
                                                <span>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏</span>
                                            </span>
                                            {% endif %}

                                            {% if event.live_streams_parsed and event.live_streams_parsed|length > 0 %}
                                            <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-red-50 text-red-700 rounded-md text-[11px] font-medium" title="–¢—Ä–∞–Ω—Å–ª—è—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞">
                                                <span class="material-symbols-outlined text-[14px]">live_tv</span>
                                                <span>–¢—Ä–∞–Ω—Å–ª—è—Ü—ñ—è</span>
                                            </span>
                                            {% endif %}

                                            {% if event.program_parsed and event.program_parsed|length > 0 %}
                                            <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-purple-50 text-purple-700 rounded-md text-[11px] font-medium" title="–ü—Ä–æ–≥—Ä–∞–º–∞ –¥–æ—Å—Ç—É–ø–Ω–∞">
                                                <span class="material-symbols-outlined text-[14px]">calendar_today</span>
                                                <span>–ü—Ä–æ–≥—Ä–∞–º–∞</span>
                                            </span>
                                            {% endif %}

                                            {% if event.weight_classes_parsed and event.weight_classes_parsed|length > 0 %}
                                            <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-amber-50 text-amber-700 rounded-md text-[11px] font-medium" title="–í–∞–≥–æ–≤—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó">
                                                <span class="material-symbols-outlined text-[14px]">fitness_center</span>
                                                <span>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</span>
                                            </span>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <!-- Action Button (Right) -->
                                    <div class="p-4 flex items-center justify-center relative z-10">
                                        <a href="/calendar/{{ event.slug }}" class="w-auto px-4 py-2 {% if event.status == 'ongoing' %}bg-blue-600 text-white hover:bg-blue-700 shadow-md shadow-blue-600/20{% elif event.status == 'completed' %}bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white{% else %}bg-blue-600 text-white hover:bg-blue-700 shadow-md shadow-blue-600/20{% endif %} font-semibold rounded-lg text-sm transition-all text-center whitespace-nowrap">
                                            {% if event.status == 'completed' %}–†–µ–∑—É–ª—å—Ç–∞—Ç–∏
                                            {% elif event.status == 'ongoing' %}–î–∏–≤–∏—Ç–∏—Å—å
                                            {% else %}–î–µ—Ç–∞–ª—ñ{% endif %}
                                        </a>
                                    </div>
                                </div>
                            </article>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <!-- Empty State -->
                    <div class="bg-white rounded-xl md:rounded-2xl p-8 md:p-12 text-center border border-gray-100">
                        <div class="inline-flex items-center justify-center w-16 h-16 md:w-20 md:h-20 rounded-full bg-gray-100 mb-4">
                            <span class="material-symbols-outlined text-gray-400 text-[36px] md:text-[48px]">event_busy</span>
                        </div>
                        <h3 class="text-lg md:text-xl font-bold text-gray-900 mb-2">–ü–æ–¥—ñ–π –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p class="text-sm md:text-base text-gray-500 mb-6">–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏ –∞–±–æ –æ–±–µ—Ä—ñ—Ç—å —ñ–Ω—à–∏–π –º—ñ—Å—è—Ü—å</p>
                        <button onclick="clearAllFilters()" class="inline-flex items-center gap-2 px-5 md:px-6 py-2.5 md:py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white rounded-lg font-bold transition-all shadow-md text-sm md:text-base">
                            <span class="material-symbols-outlined text-[18px] md:text-[20px]">filter_alt_off</span>
                            <span>–°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏</span>
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Right Column: Sidebar (4 cols) - Desktop Only -->
        <aside class="hidden lg:flex lg:col-span-4 flex-col gap-6">
            
            <!-- Quick Search -->
            <div class="bg-white rounded-2xl p-6 shadow-soft border border-white">
                <h3 class="text-lg font-bold text-gray-900 mb-4">–®–≤–∏–¥–∫–∏–π –ø–æ—à—É–∫</h3>
                {% if is_year_search %}
                <div class="mb-3 px-3 py-2 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-blue-600 text-[18px]">search</span>
                        <span class="text-xs text-blue-700 font-medium">–ü–æ—à—É–∫ –ø–æ –≤—Å—å–æ–º—É {{ current_year }} —Ä–æ—Ü—ñ</span>
                    </div>
                </div>
                {% endif %}
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <span class="material-symbols-outlined text-gray-400">search</span>
                    </span>
                    <input 
                        id="search-input"
                        class="block w-full pl-10 pr-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm placeholder-gray-400 focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600 transition-all" 
                        placeholder="–ù–∞–∑–≤–∞, –º—ñ—Å—Ç–æ, —Ä–µ–≥—ñ–æ–Ω, –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä..." 
                        value="{{ current_search }}"
                        type="text"
                    />
                </div>
                {% if current_search %}
                <button onclick="clearSearch()" class="mt-2 text-xs text-blue-600 hover:text-blue-700 font-medium flex items-center gap-1">
                    <span class="material-symbols-outlined text-[14px]">close</span>
                    <span>–û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ—à—É–∫</span>
                </button>
                {% endif %}
            </div>

            <!-- Desktop Month Navigation -->
            <div class="bg-white rounded-2xl p-6 shadow-soft border border-white">
                <div class="space-y-3">
                    <!-- Current period -->
                    <div class="text-center p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
                        <div class="text-sm text-gray-600 mb-1">–ü–µ—Ä–µ–≥–ª—è–¥–∞—î—Ç–µ</div>
                        <div class="text-xl font-black text-gray-900">{{ month_name }} {{ current_year }}</div>
                    </div>
                    
                    <!-- Events count -->
                    <div class="flex items-center justify-between px-5 py-3 bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl shadow-md">
                        <span class="text-sm text-white font-semibold">
                            {% if total_events == 1 %}–ü–æ–¥—ñ—è –∑–Ω–∞–π–¥–µ–Ω–∞{% elif total_events < 5 %}–ü–æ–¥—ñ—ó –∑–Ω–∞–π–¥–µ–Ω–æ{% else %}–ü–æ–¥—ñ–π –∑–Ω–∞–π–¥–µ–Ω–æ{% endif %}
                        </span>
                        <span class="text-3xl font-black text-white">{{ total_events }}</span>
                    </div>
                    
                    <!-- Navigation -->
                    <div class="grid grid-cols-2 gap-2">
                        <a href="#" 
                        data-nav="prev" 
                        data-month="{{ current_month - 1 if current_month > 1 else 12 }}" 
                        data-year="{{ current_year if current_month > 1 else current_year - 1 }}"
                        class="flex items-center justify-center gap-2 px-3 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-all">
                            <span class="material-symbols-outlined text-[16px]">arrow_back</span>
                            <span class="text-sm">–ù–∞–∑–∞–¥</span>
                        </a>
                        <a href="#" 
                        data-nav="next" 
                        data-month="{{ current_month + 1 if current_month < 12 else 1 }}" 
                        data-year="{{ current_year if current_month < 12 else current_year + 1 }}"
                        class="flex items-center justify-center gap-2 px-3 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-all">
                            <span class="text-sm">–í–ø–µ—Ä–µ–¥</span>
                            <span class="material-symbols-outlined text-[16px]">arrow_forward</span>
                        </a>
                    </div>

                    
                    <a href="/calendar" class="block w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white text-center font-semibold rounded-lg transition-all">
                        –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ —Å—å–æ–≥–æ–¥–Ω—ñ
                    </a>
                </div>
            </div>

            <!-- Upcoming Events Timeline -->
            <div class="bg-white rounded-2xl p-6 shadow-soft border border-white">
                <div class="flex items-center gap-3 mb-5">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white shadow-lg">
                        <span class="material-symbols-outlined text-[22px]">event_upcoming</span>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">–ù–∞–π–±–ª–∏–∂—á—ñ –ø–æ–¥—ñ—ó</h3>
                        <p class="text-xs text-gray-500">–í—ñ–¥ —Å—å–æ–≥–æ–¥–Ω—ñ</p>
                    </div>
                </div>

                {% if upcoming_events %}
                <div class="space-y-3">
                    {% for event in upcoming_events %}
                    <a href="/calendar/{{ event.slug }}" class="block group">
                        <div class="relative pl-5 {% if not loop.last %}pb-3 border-l-2 border-gray-200{% endif %}">
                            <!-- Timeline dot -->
                            <div class="absolute left-0 top-1 -translate-x-1/2 w-2.5 h-2.5 rounded-full {% if event.status == 'ongoing' %}bg-red-600 animate-pulse{% elif event.status == 'planned' %}bg-blue-600{% else %}bg-gray-400{% endif %} ring-4 ring-white"></div>
                            
                            <!-- Event content -->
                            <div class="flex items-start justify-between gap-2 mb-1">
                                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">
                                    {{ event.date_start.day }} {{ event.month_genitive }}
                                </div>
                                {% if event.status == 'ongoing' %}
                                <span class="inline-flex items-center gap-1 px-1.5 py-0.5 bg-red-100 text-red-700 rounded text-[9px] font-bold">
                                    <span class="w-1 h-1 bg-red-600 rounded-full animate-pulse"></span>
                                    –ó–∞—Ä–∞–∑
                                </span>
                                {% endif %}
                            </div>
                            
                            <h4 class="text-sm font-bold text-gray-900 leading-tight mb-1 group-hover:text-blue-600 transition-colors line-clamp-2">
                                {{ event.title }}
                            </h4>
                            
                            <div class="flex flex-wrap items-center gap-2 text-[11px] text-gray-500">
                                {% if event.city %}
                                <span class="inline-flex items-center gap-0.5">
                                    <span class="material-symbols-outlined text-[12px]">location_on</span>
                                    {{ event.city }}
                                </span>
                                {% endif %}
                                
                                {% if event.category_label %}
                                <span class="text-gray-400">‚Ä¢</span>
                                <span class="font-medium">{{ event.category_label }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>

                <a href="/calendar" class="block w-full mt-4 pt-4 border-t border-gray-100 text-center text-sm font-semibold text-blue-600 hover:text-blue-700 transition-colors">
                    –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–µ—Å—å –∫–∞–ª–µ–Ω–¥–∞—Ä ‚Üí
                </a>
                {% else %}
                <!-- Empty state -->
                <div class="text-center py-8">
                    <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-100 mb-3">
                        <span class="material-symbols-outlined text-gray-400 text-[24px]">event_busy</span>
                    </div>
                    <p class="text-sm text-gray-500">–ù–µ–º–∞—î –Ω–∞–π–±–ª–∏–∂—á–∏—Ö –ø–æ–¥—ñ–π</p>
                </div>
                {% endif %}
            </div>

            <!-- Stats -->
            <div class="bg-white rounded-2xl p-6 shadow-soft border border-white">
                <h3 class="text-lg font-bold text-gray-900 mb-4">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">–í—Å—å–æ–≥–æ –ø–æ–¥—ñ–π</span>
                        <span class="text-lg font-bold text-gray-900 stat-value">{{ total_events }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">–ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∏—Ö</span>
                        <span class="text-lg font-bold text-purple-600 stat-value">{{ international_count }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">–ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏—Ö</span>
                        <span class="text-lg font-bold text-blue-600 stat-value">{{ national_count }}</span>
                    </div>
                    <div class="flex items-center justify-between pt-3 border-t border-gray-100">
                        <span class="text-sm text-gray-600">–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ</span>
                        <span class="text-lg font-bold text-amber-600 stat-value">{{ upcoming_count }}</span>
                    </div>
                </div>
            </div>

        </aside>
    </div>

</main>

<style>
.card-gradient {
    background: linear-gradient(135deg, #ffffff 0%, #fcfcfc 100%);
}

.shadow-soft {
    box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
}

.custom-filter-dropdown {
    position: relative;
}

.filter-dropdown-menu {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    min-width: 200px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s;
    z-index: 50;
    overflow: hidden;
}

.custom-filter-dropdown.active .filter-dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.filter-dropdown-item {
    display: block;
    width: 100%;
    padding: 10px 16px;
    font-size: 14px;
    text-align: left;
    color: #111418;
    background: transparent;
    border: none;
    cursor: pointer;
    transition: background-color 0.15s;
}

.filter-dropdown-item:hover {
    background-color: #f3f4f6;
}

.filter-dropdown-item.active {
    background-color: #eff6ff;
    font-weight: 600;
    color: #2563eb;
}


#events-container {
    transition: opacity 0.3s ease-in-out;
}

#events-container.loading {
    opacity: 0.5;
}

.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Active states for mobile */
@media (max-width: 768px) {
    button:active, a:active {
        transform: scale(0.98);
    }
}
</style>

<script data-page-script="true">
// ============================================
// CALENDAR PAGE SCRIPT - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Navigation Manager
// ============================================

(function() {
    'use strict';
    
    let searchTimeout = null;

    // ==================== URL BUILDER ====================
    
    function buildCalendarURL(params) {
        const url = new URL('/calendar', window.location.origin);
        Object.keys(params).forEach(key => {
            if (params[key] && params[key] !== 'all' && params[key] !== '') {
                url.searchParams.set(key, params[key]);
            }
        });
        return url.pathname + url.search;
    }

    // ==================== NAVIGATION ====================
    
    function navigateToMonth(month, year) {
        const params = {
            month: month,
            year: year
        };
        
        const url = buildCalendarURL(params);
        
        console.log('[Calendar] Navigating to:', month, year);
        
        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Navigation Manager
        if (window.navigationManager) {
            window.navigationManager.navigateTo(url);
        } else {
            window.location.href = url;
        }
    }

    function navigateWithFilters(scrollToTop = true) {
        const search = document.getElementById('search-input')?.value?.trim() || '';
        const status = document.querySelector('.custom-filter-dropdown[data-name="status"]')?.getAttribute('data-value') || 'all';
        const type = document.querySelector('.custom-filter-dropdown[data-name="type"]')?.getAttribute('data-value') || 'all';
        const category = document.querySelector('.custom-filter-dropdown[data-name="category"]')?.getAttribute('data-value') || 'all';
        
        // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ URL –∞–±–æ –∑ —à–∞–±–ª–æ–Ω—É
        const urlParams = new URLSearchParams(window.location.search);
        const currentYear = parseInt(urlParams.get('year')) || new Date().getFullYear();
        const currentMonth = parseInt(urlParams.get('month')) || new Date().getMonth() + 1;
        
        const params = {
            year: currentYear,
            search: search,
            status: status !== 'all' ? status : '',
            type: type !== 'all' ? type : '',
            category: category !== 'all' ? category : ''
        };
        
        // –î–æ–¥–∞—î–º–æ month –¢–Ü–õ–¨–ö–ò —è–∫—â–æ –Ω–µ–º–∞—î –ø–æ—à—É–∫—É
        if (!search || search === '') {
            params.month = currentMonth;
        }
        
        const url = buildCalendarURL(params);
        
        console.log('[Calendar] Navigating with filters:', params);
        
        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Navigation Manager
        if (window.navigationManager) {
            window.navigationManager.navigateTo(url);
        } else {
            window.location.href = url;
        }
    }

    // ==================== FILTERS ====================
    
    function applyFilters() {
        if (searchTimeout) clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            navigateWithFilters(true);
        }, 500);
    }

    function clearAllFilters() {
        const statusDropdown = document.querySelector('.custom-filter-dropdown[data-name="status"]');
        const typeDropdown = document.querySelector('.custom-filter-dropdown[data-name="type"]');
        const categoryDropdown = document.querySelector('.custom-filter-dropdown[data-name="category"]');
        
        if (statusDropdown) {
            statusDropdown.setAttribute('data-value', 'all');
            const label = statusDropdown.querySelector('.filter-label');
            if (label) label.textContent = '–°—Ç–∞—Ç—É—Å';
        }
        
        if (typeDropdown) {
            typeDropdown.setAttribute('data-value', 'all');
            const label = typeDropdown.querySelector('.filter-label');
            if (label) label.textContent = '–¢–∏–ø';
        }
        
        if (categoryDropdown) {
            categoryDropdown.setAttribute('data-value', 'all');
            const label = categoryDropdown.querySelector('.filter-label');
            if (label) label.textContent = '–ö–∞—Ç–µ–≥–æ—Ä—ñ—è';
        }
        
        const searchInput = document.getElementById('search-input');
        if (searchInput) searchInput.value = '';
        
        navigateWithFilters(true);
    }

    function clearSearch() {
        const searchInput = document.getElementById('search-input');
        if (searchInput) {
            searchInput.value = '';
            applyFilters();
        }
    }

    // ==================== DROPDOWNS ====================
    
    function initFilterDropdowns() {
        const dropdowns = document.querySelectorAll('.custom-filter-dropdown');
        
        dropdowns.forEach(dropdown => {
            const button = dropdown.querySelector('button');
            const items = dropdown.querySelectorAll('.filter-dropdown-item');
            const label = dropdown.querySelector('.filter-label');
            
            if (!button || !label) return;
            
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                
                // Close other dropdowns
                document.querySelectorAll('.custom-filter-dropdown.active').forEach(d => {
                    if (d !== dropdown) d.classList.remove('active');
                });
                
                dropdown.classList.toggle('active');
            });
            
            items.forEach(item => {
                const value = item.getAttribute('data-value');
                if (value === dropdown.getAttribute('data-value')) {
                    item.classList.add('active');
                }
                
                item.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    dropdown.setAttribute('data-value', value);
                    label.textContent = item.textContent;
                    
                    dropdown.querySelectorAll('.filter-dropdown-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    dropdown.classList.remove('active');
                    
                    navigateWithFilters(true);
                });
            });
        });
        
        // Close dropdowns on outside click
        document.addEventListener('click', () => {
            document.querySelectorAll('.custom-filter-dropdown.active').forEach(d => {
                d.classList.remove('active');
            });
        });
    }

    // ==================== MONTH NAVIGATION ====================
    
    function initMonthNavigation() {
        document.querySelectorAll('[data-nav]').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const month = parseInt(this.getAttribute('data-month'));
                const year = parseInt(this.getAttribute('data-year'));
                navigateToMonth(month, year);
            });
        });
    }

    // ==================== SEARCH ====================
    
    function initSearch() {
        const searchInput = document.getElementById('search-input');
        if (searchInput) {
            searchInput.addEventListener('input', applyFilters);
            
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    navigateWithFilters(true);
                }
            });
        }
    }

    // ==================== INITIALIZATION ====================
    
    function init() {
        // Prevent double initialization
        if (isInitialized) {
            console.log('[Calendar] Already initialized, skipping...');
            return;
        }
        
        console.log('[Calendar] Initializing page...');
        
        initFilterDropdowns();
        initMonthNavigation();
        initSearch();
        
        isInitialized = true;
        console.log('[Calendar] Page ready');
    }

    // ==================== STATE ====================
    
    let isInitialized = false;
    
    // ==================== CLEANUP ====================
    
    function cleanup() {
        console.log('[Calendar] Cleaning up...');
        
        // Clear timeouts
        if (searchTimeout) {
            clearTimeout(searchTimeout);
            searchTimeout = null;
        }
        
        // Mark as not initialized
        isInitialized = false;
    }

    // ==================== GLOBAL EXPORTS ====================
    
    window.clearAllFilters = clearAllFilters;
    window.clearSearch = clearSearch;
    window.applyFilters = applyFilters;
    window.navigateToMonth = navigateToMonth;

    // ==================== EVENT LISTENERS ====================
    
    // Initialize on page load
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

    // Cleanup on page navigation
    window.addEventListener('pageCleanup', cleanup);

    // Re-initialize on AJAX navigation
    window.addEventListener('pageInit', () => {
        // Check if we're on calendar page
        if (window.location.pathname.startsWith('/calendar')) {
            init();
        }
    });

})();
</script>

    
{% endblock %}
