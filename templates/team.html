{% extends "base.html" %}

{% block title %}–ó–±—ñ—Ä–Ω–∞ –£–∫—Ä–∞—ó–Ω–∏ –∑ –¥–∑—é–¥–æ - –§–µ–¥–µ—Ä–∞—Ü—ñ—è –î–∑—é–¥–æ –£–∫—Ä–∞—ó–Ω–∏{% endblock %}

{% block content %}
<main class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Page Header -->
    <div class="mb-8">
        <!-- Breadcrumbs -->
        <div class="flex flex-wrap items-center gap-2 text-sm mb-4">
            <a class="text-gray-600 font-medium hover:text-blue-600 transition-colors" href="/">–ì–æ–ª–æ–≤–Ω–∞</a>
            <span class="text-gray-400 font-medium">/</span>
            <span class="text-gray-900 font-semibold">–ó–±—ñ—Ä–Ω–∞</span>
        </div>
        
        <!-- Title & Description -->
        <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
            <div class="max-w-2xl">
                <h1 class="text-gray-900 text-3xl md:text-4xl font-black leading-tight tracking-tight mb-2">–ó–±—ñ—Ä–Ω–∞ –£–∫—Ä–∞—ó–Ω–∏ –∑ –¥–∑—é–¥–æ</h1>
                <p class="text-[var(--muted)] leading-relaxed mb-1">
                    –ù–∞—à—ñ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∏ —Ç–∞ —Ç—Ä–µ–Ω–µ—Ä–∏, —è–∫—ñ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç—å –£–∫—Ä–∞—ó–Ω—É –Ω–∞ —Å–≤—ñ—Ç–æ–≤—ñ–π –∞—Ä–µ–Ω—ñ
                </p>
            </div>
            
            <!-- Quick Stats -->
            <div class="hidden md:flex items-center gap-2 text-sm text-[var(--muted)] bg-white px-3 py-1.5 rounded-full border border-gray-200 shadow-sm">
                <span class="material-symbols-outlined text-[18px]">groups</span>
                <span class="font-semibold">{{ total_athletes + national_coaches_total + regional_coaches_total }}</span>
                <span>—É—á–∞—Å–Ω–∏–∫—ñ–≤</span>
            </div>
        </div>
    </div>

    <!-- Two Column Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-[280px_1fr] gap-8">
        
        <!-- Left Sidebar Navigation -->
        <aside class="w-full lg:sticky lg:top-24 h-fit">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                <!-- Header -->
                <div class="p-4 border-b border-gray-200 bg-gray-50">
                    <span class="text-xs font-bold text-gray-600 uppercase tracking-wider">–ù–∞–≤—ñ–≥–∞—Ü—ñ—è</span>
                </div>
                
                <!-- Nav Links -->
                <nav class="flex flex-col p-2 space-y-1">
                    <!-- Athletes -->
                    <a href="#athletes-section" 
                       class="nav-anchor-link group flex items-center justify-between px-3 py-3 rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900 border-l-3 border-transparent transition-all"
                       data-section="athletes-section">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-[20px]">sports_martial_arts</span>
                            <span class="font-medium text-sm">–°–ø–æ—Ä—Ç—Å–º–µ–Ω–∏</span>
                        </div>
                        <span class="text-xs font-bold text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full">{{ total_athletes }}</span>
                    </a>
                    
                    <!-- Coaches -->
                    <a href="#coaches-section" 
                       class="nav-anchor-link group flex items-center justify-between px-3 py-3 rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900 border-l-3 border-transparent transition-all"
                       data-section="coaches-section">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-[20px]">supervisor_account</span>
                            <span class="font-medium text-sm">–¢—Ä–µ–Ω–µ—Ä–∏</span>
                        </div>
                        <span class="text-xs font-bold text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full">{{ national_coaches_total + regional_coaches_total }}</span>
                    </a>
                </nav>
            </div>
            
            <!-- Quick Links Card -->
            <div class="mt-6 p-4 rounded-lg bg-blue-50 border border-blue-100 hidden lg:block">
                <div class="flex items-start gap-3">
                    <span class="material-symbols-outlined text-blue-600 text-[24px]">campaign</span>
                    <div>
                        <p class="text-sm font-semibold text-gray-900 mb-1">–°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ –∫–æ–º–∞–Ω–¥–æ—é</p>
                        <p class="text-xs text-gray-600 mb-3">–ù–æ–≤–∏–Ω–∏, –∑–º–∞–≥–∞–Ω–Ω—è —Ç–∞ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –Ω–∞—à–∏—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤</p>
                        <a class="text-xs font-bold text-blue-600 hover:underline" href="/news" data-page="news">–ß–∏—Ç–∞—Ç–∏ –Ω–æ–≤–∏–Ω–∏ ‚Üí</a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 w-full space-y-12">
            
            <!-- ==================== ATHLETES SECTION ==================== -->
            <section id="athletes-section" class="scroll-mt-24">
                
                <!-- Section Header -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white shadow-lg">
                            <span class="material-symbols-outlined text-[22px]">sports_martial_arts</span>
                        </div>
                        <div>
                            <h2 class="text-2xl font-black text-gray-900">–°–ø–æ—Ä—Ç—Å–º–µ–Ω–∏</h2>
                            <p class="text-sm text-gray-500">{{ total_athletes }} –∞—Ç–ª–µ—Ç—ñ–≤ –∑–±—ñ—Ä–Ω–æ—ó</p>
                        </div>
                    </div>
                </div>

                <!-- Filters Bar (Pills Style) -->
                <div id="athletes-filters" class="flex flex-wrap items-center gap-2 md:gap-3 bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-6">
                    
                    <!-- Search -->
                    <div class="relative flex-grow max-w-xs">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="material-symbols-outlined text-gray-400 text-[18px]">search</span>
                        </span>
                        <input 
                            type="text" 
                            id="athletes-search-input" 
                            placeholder="–ü–æ—à—É–∫..." 
                            value="{{ search_query }}"
                            class="block w-full pl-10 pr-3 py-1.5 bg-gray-50 border border-transparent hover:border-gray-200 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 rounded-lg text-sm placeholder-gray-400 focus:outline-none transition-all"
                            onkeypress="if(event.key==='Enter') applyAthletesFilters()"
                        />
                    </div>
                    
                    <!-- Sex Filter -->
                    <div class="relative group custom-filter-dropdown" data-name="sex" data-value="{{ current_sex or 'all' }}">
                        <button class="flex items-center gap-1.5 px-2.5 md:px-3 py-1.5 bg-gray-50 border border-transparent hover:border-gray-200 active:border-gray-300 rounded-lg text-xs md:text-sm font-medium transition-all text-gray-700">
                            <span class="filter-label">
                                {% if current_sex == 'men' %}‚ôÇÔ∏è –ß–æ–ª–æ–≤—ñ–∫–∏
                                {% elif current_sex == 'women' %}‚ôÄÔ∏è –ñ—ñ–Ω–∫–∏
                                {% else %}üë• –í—Å—ñ{% endif %}
                            </span>
                            <span class="material-symbols-outlined text-gray-400 text-[16px] md:text-[18px]">expand_more</span>
                        </button>
                        <div class="filter-dropdown-menu">
                            <button class="filter-dropdown-item" data-value="all">üë• –í—Å—ñ</button>
                            <button class="filter-dropdown-item" data-value="men">‚ôÇÔ∏è –ß–æ–ª–æ–≤—ñ–∫–∏</button>
                            <button class="filter-dropdown-item" data-value="women">‚ôÄÔ∏è –ñ—ñ–Ω–∫–∏</button>
                        </div>
                    </div>

                    <!-- Status Filter -->
                    <div class="relative group custom-filter-dropdown" data-name="status" data-value="{{ current_status or 'all' }}">
                        <button class="flex items-center gap-1.5 px-2.5 md:px-3 py-1.5 bg-gray-50 border border-transparent hover:border-gray-200 active:border-gray-300 rounded-lg text-xs md:text-sm font-medium transition-all text-gray-700">
                            <span class="filter-label">
                                {% if current_status == 'main' %}‚≠ê –û—Å–Ω–æ–≤–∞
                                {% elif current_status == 'candidate' %}üéØ –ö–∞–Ω–¥–∏–¥–∞—Ç
                                {% elif current_status == 'reserve' %}üí™ –†–µ–∑–µ—Ä–≤
                                {% else %}üìã –í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏{% endif %}
                            </span>
                            <span class="material-symbols-outlined text-gray-400 text-[16px] md:text-[18px]">expand_more</span>
                        </button>
                        <div class="filter-dropdown-menu">
                            <button class="filter-dropdown-item" data-value="all">üìã –í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</button>
                            <button class="filter-dropdown-item" data-value="main">‚≠ê –û—Å–Ω–æ–≤–Ω–∏–π —Å–∫–ª–∞–¥</button>
                            <button class="filter-dropdown-item" data-value="candidate">üéØ –ö–∞–Ω–¥–∏–¥–∞—Ç</button>
                            <button class="filter-dropdown-item" data-value="reserve">üí™ –†–µ–∑–µ—Ä–≤</button>
                        </div>
                    </div>

                    <!-- Clear Filters -->
                    <div class="ml-auto">
                        <button onclick="clearAthletesFilters()" class="flex items-center justify-center w-8 h-8 md:w-auto md:px-2 md:py-1.5 rounded-lg text-gray-400 hover:text-blue-600 active:bg-gray-100 transition-colors" title="–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏">
                            <span class="material-symbols-outlined text-[20px]">tune</span>
                        </button>
                    </div>
                </div>

                <!-- Athletes Grid -->
                <div id="athletes-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                    {% if athletes and athletes|length > 0 %}
                        {% for athlete in athletes %}
                        <article class="relative group cursor-pointer overflow-hidden rounded-2xl shadow-soft border border-white hover:shadow-lg transition-all duration-300 hover:-translate-y-1" 
                                 onclick="window.location.href='/team/athletes/{{ athlete.slug }}'" 
                                 style="aspect-ratio: 3/4;">
                            
                            <!-- Background Photo -->
                            <div class="absolute inset-0 overflow-hidden">
                                {% if athlete.photo_url %}
                                <img src="{{ athlete.photo_url }}" alt="{{ athlete.name }}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
                                {% else %}
                                <div class="w-full h-full bg-gradient-to-br from-blue-200 to-blue-400 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-[80px] opacity-50">person</span>
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Gradient Overlay -->
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>
                            
                            <!-- Status Badge -->
                            <div class="absolute top-3 right-3 z-20">
                                {% if athlete.status == 'main' %}
                                <span class="inline-block bg-blue-600/90 backdrop-blur-sm text-white text-[10px] font-bold uppercase px-2.5 py-1 rounded-lg shadow-lg">–û—Å–Ω–æ–≤–∞</span>
                                {% elif athlete.status == 'candidate' %}
                                <span class="inline-block bg-purple-600/90 backdrop-blur-sm text-white text-[10px] font-bold uppercase px-2.5 py-1 rounded-lg shadow-lg">–ö–∞–Ω–¥–∏–¥–∞—Ç</span>
                                {% elif athlete.status == 'reserve' %}
                                <span class="inline-block bg-amber-600/90 backdrop-blur-sm text-white text-[10px] font-bold uppercase px-2.5 py-1 rounded-lg shadow-lg">–†–µ–∑–µ—Ä–≤</span>
                                {% endif %}
                            </div>
                            
                            <!-- Content -->
                            <div class="absolute bottom-0 left-0 right-0 z-10 p-4 transition-all duration-300">
                                <h3 class="text-white text-base md:text-lg font-black leading-tight mb-1 drop-shadow-lg">{{ athlete.name }}</h3>
                                <div class="text-white/90 text-sm font-medium drop-shadow-md">
                                    {% if athlete.age_category %}{{ athlete.age_category }}{% else %}‚Äî{% endif %} ‚Ä¢ {% if athlete.weight %}{{ athlete.weight }} –∫–≥{% endif %}
                                </div>
                            </div>
                        </article>
                        {% endfor %}
                    {% else %}
                    <!-- Empty State -->
                    <div class="col-span-full bg-white rounded-xl p-12 text-center border border-gray-100">
                        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4">
                            <span class="material-symbols-outlined text-gray-400 text-[36px]">search_off</span>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">–°–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p class="text-gray-600 mb-6">–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏ –ø–æ—à—É–∫—É</p>
                        <button onclick="clearAthletesFilters()" class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition-all shadow-md">
                            <span class="material-symbols-outlined text-[20px]">refresh</span>
                            –°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏
                        </button>
                    </div>
                    {% endif %}
                </div>

                <!-- Pagination -->
                {% if total_pages and total_pages > 1 %}
                <div id="athletes-pagination" class="mt-8">
                    <div class="flex items-center justify-between bg-white rounded-xl p-4 border border-gray-100 shadow-sm">
                        <!-- Results Info -->
                        <p class="text-sm text-gray-700 hidden sm:block">
                            –ü–æ–∫–∞–∑–∞–Ω–æ <span class="font-medium text-gray-900">{{ (current_page - 1) * 16 + 1 }}</span> - 
                            <span class="font-medium text-gray-900">{{ [current_page * 16, total_athletes]|min }}</span> –∑ 
                            <span class="font-medium text-gray-900">{{ total_athletes }}</span>
                        </p>

                        <!-- Pagination Controls -->
                        <nav class="flex items-center gap-1">
                            <!-- Previous -->
                            {% if has_prev %}
                            <a href="?page={{ current_page - 1 }}{% if current_sex != 'all' %}&sex={{ current_sex }}{% endif %}{% if current_status != 'all' %}&status={{ current_status }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" 
                               data-page="team"
                               class="pagination-btn w-9 h-9 flex items-center justify-center rounded-lg border border-gray-300 bg-white hover:border-blue-600 hover:bg-blue-50 transition-all">
                                <span class="material-symbols-outlined text-[18px]">chevron_left</span>
                            </a>
                            {% else %}
                            <span class="w-9 h-9 flex items-center justify-center rounded-lg border border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed">
                                <span class="material-symbols-outlined text-[18px]">chevron_left</span>
                            </span>
                            {% endif %}

                            <!-- Pages -->
                            {% set start_page = [1, current_page - 2]|max %}
                            {% set end_page = [total_pages, current_page + 2]|min %}
                            
                            {% for page_num in range(start_page, end_page + 1) %}
                                {% if page_num == current_page %}
                                <span class="w-9 h-9 flex items-center justify-center rounded-lg bg-blue-600 text-white text-sm font-bold shadow-md">{{ page_num }}</span>
                                {% else %}
                                <a href="?page={{ page_num }}{% if current_sex != 'all' %}&sex={{ current_sex }}{% endif %}{% if current_status != 'all' %}&status={{ current_status }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" 
                                   data-page="team"
                                   class="pagination-btn w-9 h-9 flex items-center justify-center rounded-lg border border-gray-300 bg-white hover:border-blue-600 hover:bg-blue-50 text-sm font-medium transition-all">{{ page_num }}</a>
                                {% endif %}
                            {% endfor %}

                            <!-- Next -->
                            {% if has_next %}
                            <a href="?page={{ current_page + 1 }}{% if current_sex != 'all' %}&sex={{ current_sex }}{% endif %}{% if current_status != 'all' %}&status={{ current_status }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" 
                               data-page="team"
                               class="pagination-btn w-9 h-9 flex items-center justify-center rounded-lg border border-gray-300 bg-white hover:border-blue-600 hover:bg-blue-50 transition-all">
                                <span class="material-symbols-outlined text-[18px]">chevron_right</span>
                            </a>
                            {% else %}
                            <span class="w-9 h-9 flex items-center justify-center rounded-lg border border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed">
                                <span class="material-symbols-outlined text-[18px]">chevron_right</span>
                            </span>
                            {% endif %}
                        </nav>
                    </div>
                </div>
                {% endif %}
            </section>

            <!-- ==================== COACHES SECTION ==================== -->
            <section id="coaches-section" class="scroll-mt-24">
                
                <!-- Section Header -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-orange-500 to-amber-600 flex items-center justify-center text-white shadow-lg">
                            <span class="material-symbols-outlined text-[22px]">supervisor_account</span>
                        </div>
                        <div>
                            <h2 class="text-2xl font-black text-gray-900">–¢—Ä–µ–Ω–µ—Ä—Å—å–∫–∏–π —à—Ç–∞–±</h2>
                            <p class="text-sm text-gray-500">{{ national_coaches_total + regional_coaches_total }} —Ç—Ä–µ–Ω–µ—Ä—ñ–≤</p>
                        </div>
                    </div>
                </div>

                <!-- Filters Bar -->
                <div id="coaches-filters" class="flex flex-wrap items-center gap-2 md:gap-3 bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-6">
                    
                    <!-- Search -->
                    <div class="relative flex-grow max-w-xs">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="material-symbols-outlined text-gray-400 text-[18px]">search</span>
                        </span>
                        <input 
                            type="text" 
                            id="coaches-search-input" 
                            placeholder="–Ü–º'—è, –º—ñ—Å—Ç–æ..." 
                            value="{{ coaches_search_query }}"
                            class="block w-full pl-10 pr-3 py-1.5 bg-gray-50 border border-transparent hover:border-gray-200 focus:border-orange-600 focus:ring-1 focus:ring-orange-600 rounded-lg text-sm placeholder-gray-400 focus:outline-none transition-all"
                            onkeypress="if(event.key==='Enter') applyCoachesFilters()"
                        />
                    </div>
                    
                    <!-- Team Type Filter -->
                    <div class="relative group custom-filter-dropdown" data-name="coaches_tab" data-value="{{ coaches_tab or 'all' }}">
                        <button class="flex items-center gap-1.5 px-2.5 md:px-3 py-1.5 bg-gray-50 border border-transparent hover:border-gray-200 active:border-gray-300 rounded-lg text-xs md:text-sm font-medium transition-all text-gray-700">
                            <span class="filter-label">
                                {% if coaches_tab == 'national' %}üèÜ –ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∞
                                {% elif coaches_tab == 'regional' %}üåç –†–µ–≥—ñ–æ–Ω–∞–ª—å–Ω—ñ
                                {% else %}üë• –í—Å—ñ —Ç—Ä–µ–Ω–µ—Ä–∏{% endif %}
                            </span>
                            <span class="material-symbols-outlined text-gray-400 text-[16px] md:text-[18px]">expand_more</span>
                        </button>
                        <div class="filter-dropdown-menu">
                            <button class="filter-dropdown-item" data-value="all">üë• –í—Å—ñ —Ç—Ä–µ–Ω–µ—Ä–∏</button>
                            <button class="filter-dropdown-item" data-value="national">üèÜ –ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∞ ({{ national_coaches_total }})</button>
                            <button class="filter-dropdown-item" data-value="regional">üåç –†–µ–≥—ñ–æ–Ω–∞–ª—å–Ω—ñ ({{ regional_coaches_total }})</button>
                        </div>
                    </div>

                    <!-- Category Filter -->
                    <div class="relative group custom-filter-dropdown" data-name="coach_category" data-value="{{ current_coach_category or 'all' }}">
                        <button class="flex items-center gap-1.5 px-2.5 md:px-3 py-1.5 bg-gray-50 border border-transparent hover:border-gray-200 active:border-gray-300 rounded-lg text-xs md:text-sm font-medium transition-all text-gray-700">
                            <span class="filter-label">
                                {% if current_coach_category and current_coach_category != 'all' %}{{ coach_category_labels.get(current_coach_category, '–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó') }}
                                {% else %}üìã –í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó{% endif %}
                            </span>
                            <span class="material-symbols-outlined text-gray-400 text-[16px] md:text-[18px]">expand_more</span>
                        </button>
                        <div class="filter-dropdown-menu">
                            <button class="filter-dropdown-item" data-value="all">üìã –í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</button>
                            {% for key, label in coach_category_labels.items() %}
                            <button class="filter-dropdown-item" data-value="{{ key }}">{{ label }}</button>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Clear Filters -->
                    <div class="ml-auto">
                        <button onclick="clearCoachesFilters()" class="flex items-center justify-center w-8 h-8 md:w-auto md:px-2 md:py-1.5 rounded-lg text-gray-400 hover:text-orange-600 active:bg-gray-100 transition-colors" title="–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏">
                            <span class="material-symbols-outlined text-[20px]">tune</span>
                        </button>
                    </div>
                </div>

                <!-- Coaches List -->
                <div id="coaches-list" class="space-y-3">
                    {% if coaches and coaches|length > 0 %}
                        {% for coach in coaches %}
                        <article class="group cursor-pointer bg-white rounded-xl border border-gray-100 hover:border-orange-200 hover:shadow-md transition-all duration-300 overflow-hidden"
                                 onclick="window.location.href='/team/coaches/{{ coach.slug }}'">
                            <div class="flex items-center gap-4 p-4">
                                <!-- Photo -->
                                <div class="flex-shrink-0 w-16 h-16 md:w-20 md:h-20 rounded-xl overflow-hidden">
                                    {% if coach.image_url %}
                                    <img src="{{ coach.image_url }}" alt="{{ coach.name }}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                                    {% else %}
                                    <div class="w-full h-full bg-gradient-to-br from-orange-200 to-amber-300 flex items-center justify-center">
                                        <span class="material-symbols-outlined text-white text-[32px]">person</span>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- Info -->
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-base md:text-lg font-bold text-gray-900 group-hover:text-orange-600 transition-colors truncate">{{ coach.name }}</h3>
                                    <p class="text-sm text-gray-600 truncate">
                                        {% if coach.position %}{{ coach.position }}{% else %}–¢—Ä–µ–Ω–µ—Ä{% endif %}
                                        {% if coach.city %} ‚Ä¢ {{ coach.city }}{% endif %}
                                    </p>
                                    <div class="flex items-center gap-2 mt-1 flex-wrap">
                                        {% if coach.is_national_team %}
                                        <span class="inline-flex items-center px-2 py-0.5 bg-orange-50 text-orange-700 rounded-md text-xs font-medium border border-orange-200">üèÜ –ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∞ –∫–æ–º–∞–Ω–¥–∞</span>
                                        {% else %}
                                        <span class="inline-flex items-center px-2 py-0.5 bg-amber-50 text-amber-700 rounded-md text-xs font-medium border border-amber-200">{{ coach.category_label if coach.category_label else '–†–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–∏–π' }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- Arrow Icon -->
                                <div class="flex-shrink-0 hidden md:flex">
                                    <span class="material-symbols-outlined text-gray-400 group-hover:text-orange-600 group-hover:translate-x-1 transition-all">arrow_forward</span>
                                </div>
                            </div>
                        </article>
                        {% endfor %}
                    {% else %}
                    <!-- Empty State -->
                    <div class="bg-white rounded-xl p-12 text-center border border-gray-100">
                        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4">
                            <span class="material-symbols-outlined text-gray-400 text-[36px]">search_off</span>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">–¢—Ä–µ–Ω–µ—Ä—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p class="text-gray-600 mb-6">–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏ –ø–æ—à—É–∫—É</p>
                        <button onclick="clearCoachesFilters()" class="inline-flex items-center gap-2 px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-xl font-bold transition-all shadow-md">
                            <span class="material-symbols-outlined text-[20px]">refresh</span>
                            –°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏
                        </button>
                    </div>
                    {% endif %}
                </div>

                <!-- Coaches Pagination -->
                {% if coaches_total_pages and coaches_total_pages > 1 %}
                <div class="mt-8">
                    <div class="flex items-center justify-between bg-white rounded-xl p-4 border border-gray-100 shadow-sm">
                        <!-- Results Info -->
                        <p class="text-sm text-gray-700 hidden sm:block">
                            –°—Ç–æ—Ä—ñ–Ω–∫–∞ <span class="font-medium text-gray-900">{{ coaches_page }}</span> –∑ <span class="font-medium text-gray-900">{{ coaches_total_pages }}</span>
                        </p>

                        <!-- Pagination Controls -->
                        <nav class="flex items-center gap-1">
                            <!-- Previous -->
                            {% if coaches_has_prev %}
                            <a href="?page={{ current_page }}&coaches_page={{ coaches_page - 1 }}&coaches_tab={{ coaches_tab }}{% if current_sex != 'all' %}&sex={{ current_sex }}{% endif %}{% if current_status != 'all' %}&status={{ current_status }}{% endif %}#coaches-section" 
                               data-page="team"
                               class="pagination-btn w-9 h-9 flex items-center justify-center rounded-lg border border-gray-300 bg-white hover:border-orange-500 hover:bg-orange-50 transition-all">
                                <span class="material-symbols-outlined text-[18px]">chevron_left</span>
                            </a>
                            {% else %}
                            <span class="w-9 h-9 flex items-center justify-center rounded-lg border border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed">
                                <span class="material-symbols-outlined text-[18px]">chevron_left</span>
                            </span>
                            {% endif %}

                            <!-- Pages -->
                            {% set start_page = [1, coaches_page - 2]|max %}
                            {% set end_page = [coaches_total_pages, coaches_page + 2]|min %}
                            
                            {% for page_num in range(start_page, end_page + 1) %}
                                {% if page_num == coaches_page %}
                                <span class="w-9 h-9 flex items-center justify-center rounded-lg bg-orange-600 text-white text-sm font-bold shadow-md">{{ page_num }}</span>
                                {% else %}
                                <a href="?page={{ current_page }}&coaches_page={{ page_num }}&coaches_tab={{ coaches_tab }}{% if current_sex != 'all' %}&sex={{ current_sex }}{% endif %}{% if current_status != 'all' %}&status={{ current_status }}{% endif %}#coaches-section" 
                                   data-page="team"
                                   class="pagination-btn w-9 h-9 flex items-center justify-center rounded-lg border border-gray-300 bg-white hover:border-orange-500 hover:bg-orange-50 text-sm font-medium transition-all">{{ page_num }}</a>
                                {% endif %}
                            {% endfor %}

                            <!-- Next -->
                            {% if coaches_has_next %}
                            <a href="?page={{ current_page }}&coaches_page={{ coaches_page + 1 }}&coaches_tab={{ coaches_tab }}{% if current_sex != 'all' %}&sex={{ current_sex }}{% endif %}{% if current_status != 'all' %}&status={{ current_status }}{% endif %}#coaches-section" 
                               data-page="team"
                               class="pagination-btn w-9 h-9 flex items-center justify-center rounded-lg border border-gray-300 bg-white hover:border-orange-500 hover:bg-orange-50 transition-all">
                                <span class="material-symbols-outlined text-[18px]">chevron_right</span>
                            </a>
                            {% else %}
                            <span class="w-9 h-9 flex items-center justify-center rounded-lg border border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed">
                                <span class="material-symbols-outlined text-[18px]">chevron_right</span>
                            </span>
                            {% endif %}
                        </nav>
                    </div>
                </div>
                {% endif %}
            </section>

        </div>
    </div>
</main>

<style>
    /* Custom Filter Dropdowns */
    .custom-filter-dropdown {
        position: relative;
    }

    .filter-dropdown-menu {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        min-width: 200px;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.2s;
        z-index: 50;
        overflow: hidden;
    }

    .custom-filter-dropdown.active .filter-dropdown-menu {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .filter-dropdown-item {
        display: block;
        width: 100%;
        padding: 10px 16px;
        font-size: 14px;
        text-align: left;
        color: #111418;
        background: transparent;
        border: none;
        cursor: pointer;
        transition: background-color 0.15s;
    }

    .filter-dropdown-item:hover {
        background-color: #f3f4f6;
    }

    .filter-dropdown-item.active {
        background-color: #eff6ff;
        font-weight: 600;
        color: #2563eb;
    }

    /* Grid Transitions */
    #athletes-grid,
    #coaches-list {
        transition: opacity 0.3s ease-in-out;
    }

    #athletes-grid.loading,
    #coaches-list.loading {
        opacity: 0.5;
    }

    /* Smooth Scroll */
    html {
        scroll-behavior: smooth;
    }

    /* Sidebar Active States */
    .nav-anchor-link.active {
        background-color: #eff6ff !important;
        color: #2563eb !important;
        font-weight: 600;
        border-left: 3px solid #2563eb;
    }

    .shadow-soft {
        box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
    }
</style>
{% endblock %}

{% block scripts %}
<script data-page-script="true">
    (function() {
        'use strict';
        
        let isInitialized = false;
        
        // ==================== URL BUILDERS ====================
        
        function buildAthletesURL(filters) {
            let url = '/team?page=' + (filters.page || 1);
            
            if (filters.sex && filters.sex !== 'all') url += '&sex=' + filters.sex;
            if (filters.status && filters.status !== 'all') url += '&status=' + filters.status;
            if (filters.search) url += '&search=' + encodeURIComponent(filters.search);
            
            return url;
        }
        
        function buildCoachesURL(filters) {
            const params = new URLSearchParams();
            
            params.set('page', filters.page || 1);
            if (filters.sex && filters.sex !== 'all') params.set('sex', filters.sex);
            if (filters.status && filters.status !== 'all') params.set('status', filters.status);
            
            params.set('coaches_tab', filters.coachesTab || 'all');
            params.set('coaches_page', filters.coachesPage || 1);
            
            if (filters.coachCategory && filters.coachCategory !== 'all') {
                params.set('coach_category', filters.coachCategory);
            }
            
            if (filters.coachesSearch) {
                params.set('coaches_search', filters.coachesSearch);
            }
            
            return '/team?' + params.toString() + '#coaches-section';
        }
        
        function navigateToURL(url) {
            if (window.navigationManager) {
                window.navigationManager.navigateTo(url);
            } else {
                window.location.href = url;
            }
        }
        
        // ==================== ATHLETES FILTERS ====================
        
        function applyAthletesFilters() {
            const sex = document.querySelector('[data-name="sex"]')?.getAttribute('data-value') || 'all';
            const status = document.querySelector('[data-name="status"]')?.getAttribute('data-value') || 'all';
            const search = document.getElementById('athletes-search-input')?.value?.trim() || '';
            
            const filters = { sex, status, search, page: 1 };
            const url = buildAthletesURL(filters);
            navigateToURL(url);
        }
        
        function clearAthletesFilters() {
            navigateToURL('/team');
        }
        
        // ==================== COACHES FILTERS ====================
        
        function applyCoachesFilters() {
            const coachesTab = document.querySelector('[data-name="coaches_tab"]')?.getAttribute('data-value') || 'all';
            const coachCategory = document.querySelector('[data-name="coach_category"]')?.getAttribute('data-value') || 'all';
            const coachesSearch = document.getElementById('coaches-search-input')?.value?.trim() || '';
            
            const urlParams = new URLSearchParams(window.location.search);
            const filters = {
                page: parseInt(urlParams.get('page')) || 1,
                sex: urlParams.get('sex') || 'all',
                status: urlParams.get('status') || 'all',
                coachesTab,
                coachCategory,
                coachesSearch,
                coachesPage: 1
            };
            
            const url = buildCoachesURL(filters);
            navigateToURL(url);
        }
        
        function clearCoachesFilters() {
            const urlParams = new URLSearchParams(window.location.search);
            const url = '/team?page=' + (urlParams.get('page') || '1') + '&coaches_tab=all#coaches-section';
            navigateToURL(url);
        }
        
        // ==================== DROPDOWNS ====================
        
        function initFilterDropdowns() {
            const dropdowns = document.querySelectorAll('.custom-filter-dropdown');
            
            dropdowns.forEach(dropdown => {
                const button = dropdown.querySelector('button');
                const items = dropdown.querySelectorAll('.filter-dropdown-item');
                const label = dropdown.querySelector('.filter-label');
                
                if (!button || !label) return;
                
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    // Close others
                    document.querySelectorAll('.custom-filter-dropdown.active').forEach(d => {
                        if (d !== dropdown) d.classList.remove('active');
                    });
                    
                    dropdown.classList.toggle('active');
                });
                
                items.forEach(item => {
                    const value = item.getAttribute('data-value');
                    if (value === dropdown.getAttribute('data-value')) {
                        item.classList.add('active');
                    }
                    
                    item.addEventListener('click', function(e) {
                        e.stopPropagation();
                        
                        dropdown.setAttribute('data-value', value);
                        label.textContent = this.textContent;
                        
                        dropdown.querySelectorAll('.filter-dropdown-item').forEach(i => {
                            i.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        dropdown.classList.remove('active');
                    });
                });
            });
            
            // Close on outside click
            document.addEventListener('click', function() {
                document.querySelectorAll('.custom-filter-dropdown.active').forEach(d => {
                    d.classList.remove('active');
                });
            });
        }
        
        // ==================== SIDEBAR SCROLL SPY ====================
        
        function initScrollSpy() {
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('.nav-anchor-link');
            
            function updateActiveLink() {
                let current = '';
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    if (window.scrollY >= (sectionTop - 200)) {
                        current = section.getAttribute('id');
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-section') === current) {
                        link.classList.add('active');
                    }
                });
            }
            
            window.addEventListener('scroll', updateActiveLink);
            updateActiveLink(); // Initial call
        }
        
        // ==================== INITIALIZATION ====================
        
        function init() {
            if (isInitialized) return;
            
            console.log('[Team] Initializing...');
            
            initFilterDropdowns();
            initScrollSpy();
            
            // Handle hash on load
            if (window.location.hash) {
                setTimeout(() => {
                    const element = document.querySelector(window.location.hash);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }
            
            isInitialized = true;
            console.log('[Team] Ready');
        }
        
        function cleanup() {
            console.log('[Team] Cleanup');
            isInitialized = false;
        }
        
        // ==================== GLOBAL EXPORTS ====================
        
        window.applyAthletesFilters = applyAthletesFilters;
        window.clearAthletesFilters = clearAthletesFilters;
        window.applyCoachesFilters = applyCoachesFilters;
        window.clearCoachesFilters = clearCoachesFilters;
        
        // ==================== AUTO-INIT ====================
        
        window.addEventListener('pageCleanup', cleanup);
        window.addEventListener('pageInit', () => {
            if (window.location.pathname.startsWith('/team')) init();
        });
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
    })();
</script>
{% endblock %}
